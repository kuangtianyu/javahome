# 日志

- 日志的优点：
  - 可以很容易地取消全部日志记录，或者仅仅取消某个级别以下的日志，而且可以很容易地再次打开日志开关
  - 可以很简单地禁止日志记录，因此，将这些日志代码留在程序中的开销很小
  - 日志记录可以被定向到不同的处理器，如在控制台显示、写至文件
  - 日志记录器和处理器都可以对记录进行过滤，过滤器可以根据过滤器实现器指定的标准丢弃那些无用的记录项
  - 日志记录可以采用不同的方式格式化，例如，纯文本或XML
  - 应用程序可以使用多个记录器，它们使用与包名类似的有层次结构的名字，例如，com.mycompany.myapp
  - 日志系统的配置有配置文件控制。

### 7.5.1 基本日志

- 要生成简单的日志记录，可以使用全局日志记录器并调用其info方法：

  ```java
  Logger.getGlobal().info("File -> Open menu item selected");
  ```

  默认情况下回打印如下记录：

  ```java
  May 10, 2013 10:12:15 PM LoggingImageViewer fileOpen
  INFO: File -> Open menu item selected
  ```

- 取消所有的日志：

  ```java
  Logger.getGlobal().setLevel(Level.OFF); //在适当的地方（如main的最前面）调用
  ```

### 7.5.2 高级日志

- 可以调用 getLogger 方法创建或获取自己的日志记录器

  ```java
  private static final Logger myLogger = Logger.getLogger("com.mycompany.myapp");
  ```

- 日志记录器具有层次结构，父与子之间将共享某些属性。如记录器”com.mycompany“设置了日志级别，它的日志记录器也会继承这个级别

- 7个日志级别：

  - SEVERE
  - WARNING
  - INFO
  - CONFIG
  - FINE
  - FINER
  - FINEST

  默认情况下，实际上只记录前3个级别。也可以设置一个不同的级别，例如：

  ```java
  logger.setLevel(Level.FINE);
  ```

  现在，FINE以及所有更高级别的日志都会记录

- 可以使用level.All开启 所有级别的日志记录，或者使用Level.OFF关闭所有级别的日志记录
- 默认的日志记录将显示根据调用堆栈得出的包含日志调用的类名和方法名
- 日志记录的常见用途是记录那些预料之外的异常

### 7.5.3 修改日志管理器配置

- 可以通过编辑配置文件来修改日志系统的各个属性。在默认 情况下，配置文件位于：conf/logging.properties

- 要想使用另一个配置文件，就要将 java.util.logging.config.file属性设置为那个文件的位置，为此要用一下命令启动应用程序：

  ```
  java -Djava.util.logging.config.file = configFile MainClass
  ```

- 要想修改默认的日志级别，就需要编辑配置文件，并修改以下命令行：

  ```
  .level = INFO
  ```

- 可以通过添加下面这一行来指定自定义日志记录器的日志级别：

  ```
  com.mycompany.myapp.level = FINE
  ```

  也就是说，在日志记录器后面追加后缀 .level

- 日志记录器并不将消息发送到控制台，那是处理器的任务。处理器也有级别。要想在控制台上看到FINE级别的消息，就需要进行以下设置

  ```
  java.util.logging.ConsoleHandler.level = FINE
  ```

### 7.5.4 处理器

- 在默认情况下，日志记录器将记录发送到ConsoleHandler, 并由它输出到System.err流。具体的，日志记录器会把记录发送到父处理器
- 与日志记录器一样，处理器也有日志级别。对于一个要记录的日志记录器，它的日志级别必须高于日志记录器和处理器二者的阈值。
- 要想记录FINE级别的日志，就必须修改配置文件中的默认日志记录器级别和处理器级别。另外，还可以绕过配置文件，安装你自己的处理器
- 在默认情况下，日志记录器将记录发送到自己的处理器和父日志记录器的处理器。我们的日志记录器是祖先日志记录器（名为" "）的子类，而这个祖先日志记录器会把所有等于或高于INFO级别的记录发送到控制台
- 日志API提供了两个处理器：FileHandler 和 SocketHandler。SocketHandler将记录发送到指定的主机和端口。FileHandler将记录收集到文件中

### 7.5.5 过滤器

- 在默认情况下，会根据日志记录的级别进行过滤。每个日志记录器和处理器都有一个可选的过滤器来完成附加的过滤

- 要定义一个过滤器，需要实现Filter接口并定义以下方法：

  ```
  boolean isLoggable(LogRecord record)
  ```

- 要想将一个过滤器安装到一个日志记录器或处理器中，只需要调用 setFilter 方法就可以了。注意：同一时刻最多只能有一个过滤器

### 7.5.6 格式化器

- ConsoleHandler 类和 FileHandler 类可以生成文本和XML格式的日志记录。也可以自定义格式：

  ```
  String format(LogRecord record)
  ```

  可以根据自己的需要以任何方法对记录中的信息进行格式化，并返回结果字符串。在 format 方法中，调用以下方法：

  ```
  String formatMessage(LogRecord record)
  ```

  这个方法对记录中的消息部分进行格式化，并替换参数并应用本地化处理

- 调用setFormatter 方法将格式化器安装到处理器中

### 7.5.8 日志技巧

- 对一个简单的应用，选择一个日志记录器。可以把日志记录器命名为与主应用包一样的名字
- 默认的日志配置器会把级别等于或高于 INFO 的所有消息记录到控制台。
- 所有级别为 INFO、WARNING 和 SEVERE的消息都将显示到控制台上。因此，最好只将对程序用户有意义的消息设置为这几个级别。将程序员想要的日志消息设定为 FINE 级别是一个很好的选择